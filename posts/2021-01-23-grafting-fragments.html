<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Schmidtke">
<meta name="dcterms.date" content="2021-01-23">
<meta name="description" content="This is a quick set-up for attaching a fragment to a molecule on a particular location.">

<title>Spinning coral - Grafting fragments onto molecules in rdkit - babysteps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Spinning coral</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pschmidtke" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://masto.ai/@pschmidtke" rel="" target=""><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Grafting fragments onto molecules in rdkit - babysteps</h1>
                  <div>
        <div class="description">
          This is a quick set-up for attaching a fragment to a molecule on a particular location.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">rdkit</div>
                <div class="quarto-category">3d-editor</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Schmidtke </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 23, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#context" id="toc-context" class="nav-link active" data-scroll-target="#context">Context</a>
  <ul class="collapse">
  <li><a href="#the-molecule-to-modify" id="toc-the-molecule-to-modify" class="nav-link" data-scroll-target="#the-molecule-to-modify">The molecule to modify</a></li>
  <li><a href="#the-fragment-to-add" id="toc-the-fragment-to-add" class="nav-link" data-scroll-target="#the-fragment-to-add">The fragment to add</a></li>
  <li><a href="#preliminary-steps" id="toc-preliminary-steps" class="nav-link" data-scroll-target="#preliminary-steps">Preliminary steps</a></li>
  <li><a href="#aligning-the-fragment-onto-the-molecule" id="toc-aligning-the-fragment-onto-the-molecule" class="nav-link" data-scroll-target="#aligning-the-fragment-onto-the-molecule">Aligning the fragment onto the molecule</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>In this quick walkthrough I describe the first steps to attach fragments from a fragment library onto a molecule of interest. The main idea here is to prepare code snippets for the integration of all of this into the web-based 3d-editor project I started with Daniel Alvarez some time ago. As I’m learning a lot of new things about rdkit I prefer to write it up here, as I found most of the relevant information in the mailing list &amp; the rdkit documentation.</p>
<section id="the-molecule-to-modify" class="level3">
<h3 class="anchored" data-anchor-id="the-molecule-to-modify">The molecule to modify</h3>
<p>I’ll go for the same molecule as the one used for now in our BRD4 structure of the <a href="https://github.com/Discngine/3d-editor">3d editor project</a> - that just comes from one of the <a href="https://notebook.community/open-forcefield-group/openforcefield/examples/using_smirnoff_with_amber_protein_forcefield/BRD4_inhibitor_benchmark">official openforcefield examples here</a>.</p>
</section>
<section id="the-fragment-to-add" class="level3">
<h3 class="anchored" data-anchor-id="the-fragment-to-add">The fragment to add</h3>
<p>I wanted to go for something easy for now … so let’s start with a methyl group ;) I made a quick shoutout on twitter on current available 3D fragments that could be helpful to write such a sketcher. <a href="https://twitter.com/ghutchis">Geoff Hutchison</a> (Mr Avogadro) gave me a great hint to <a href="https://github.com/openchemistry/molecules">this library here</a>. It contains way more fragments than I’d initially considered for this project and the coordinates seem reasonable &amp; compatible with the systems we’ll manage in the 3d-editor.</p>
<p>So I just took the methane from there (for now), ran it through Marvinsketch to replace one of the protons with an R group and then exported the whole thing as mol file (to the best of my knowledge rdkit doesn’t support the chemistry markup language yet).</p>
</section>
<section id="preliminary-steps" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-steps">Preliminary steps</h3>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://sourceforge.net/p/rdkit/mailman/message/34922663/ procedure extracted from this support request</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rdkit</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Draw</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>IPythonConsole.ipython_useSVG<span class="op">=</span><span class="va">True</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> py3Dmol</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> AllChem</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.rdMolAlign <span class="im">import</span> AlignMol</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below, the molecule we want to add the methyl group to. We’ll attach it on the triazole ring.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>suppl <span class="op">=</span> Chem.SDMolSupplier(<span class="st">'../data/ligand.sdf'</span>,removeHs<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mol <span class="kw">in</span> suppl:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    mblock <span class="op">=</span> Chem.MolToMolBlock(mol)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>viewer <span class="op">=</span> py3Dmol.view(width<span class="op">=</span><span class="dv">300</span>, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>viewer.addModel(mblock, <span class="st">'mol'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>viewer.setStyle({<span class="st">"stick"</span>:{}})</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>viewer.zoomTo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_161144126841433" style="position: relative; width: 300px; height: 300px">
        <p id="3dmolwarning_161144126841433" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.csb.pitt.edu/build/3Dmol.js');
}

var viewer_161144126841433 = null;
var warn = document.getElementById("3dmolwarning_161144126841433");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_161144126841433 = $3Dmol.createViewer($("#3dmolviewer_161144126841433"),{backgroundColor:"white"});
    viewer_161144126841433.addModel("BRD4, Ligand 1\n     RDKit          3D\n\n 26 28  0  0  0  0  0  0  0  0999 V2000\n    2.7960   -3.1170   11.5320 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5010   -4.1570    9.3850 N   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1660   -3.4780   12.7880 N   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1910   -5.2940   11.4140 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4400   -1.8530   11.0440 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.1160   -1.7280    9.7460 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.8220   -4.2440   10.7070 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.1730   -2.9820    8.9350 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.8140   -2.8670    7.4750 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.3840   -4.7830   12.6560 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4000   -0.6670   11.9180 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0530    0.5050   11.5340 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0160    1.6280   12.3610 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.3260    1.5790   13.5730 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.6740    0.4080   13.9570 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.7100   -0.7140   13.1300 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.8440   -0.8220    9.3340 H   0  0  0  0  0  0  0  0  0  0  0  0\n    1.8940   -3.8280    7.0110 H   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4830   -2.1830    6.9960 H   0  0  0  0  0  0  0  0  0  0  0  0\n    0.8100   -2.5080    7.3820 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.6820   -5.3710   13.4500 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.5640    0.5410   10.6380 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4990    2.4950   12.0770 H   0  0  0  0  0  0  0  0  0  0  0  0\n    2.2980    2.4090   14.1850 H   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1650    0.3720   14.8540 H   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2260   -1.5800   13.4140 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1  3  1  0\n  1  5  1  0\n  1  7  1  0\n  2  7  1  0\n  2  8  2  0\n  3 10  2  0\n  4  7  2  0\n  4 10  1  0\n  5  6  2  0\n  5 11  1  0\n  6  8  1  0\n  6 17  1  0\n  8  9  1  0\n  9 18  1  0\n  9 19  1  0\n  9 20  1  0\n 10 21  1  0\n 11 12  2  0\n 11 16  1  0\n 12 13  1  0\n 12 22  1  0\n 13 14  2  0\n 13 23  1  0\n 14 15  1  0\n 14 24  1  0\n 15 16  2  0\n 15 25  1  0\n 16 26  1  0\nM  END\n","mol");
    viewer_161144126841433.setStyle({"stick": {}});
    viewer_161144126841433.zoomTo();
viewer_161144126841433.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;py3Dmol.view at 0x7f9a708b8e50&gt;</code></pre>
</div>
</div>
<p>As the aim is to integrate that into the 3D-editor, the user ultimately will be able to click on the proton where he wants to place the fragment. Thus, we know which exact atom we want to attach it to. Below I’m determining this showing plain atom indices in the rdkit molecule</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> atom <span class="kw">in</span> mol.GetAtoms():</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        atom.SetAtomMapNum(atom.GetIdx())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mol2d<span class="op">=</span>copy.deepcopy(mol)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>AllChem.Compute2DCoords(mol2d)    <span class="co">#do this on a copy here</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Draw.MolToImage(mol2d, includeAtomNumbers<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<p><img src="2021-01-23-grafting-fragments_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Next I’m loading the fragment and extract the position of the R-group and the connected atom as atom indices (I’ll need that later). I know this is very limited and ugly for now, but it serves the purpose here &amp; now ;)</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getAttachmentVector(mol):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" for a fragment to add, search for the position of the attachment point and extract the atom id's of the attachment point and the connected atom (currently only single bond supported)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    mol: fragment passed as rdkit molecule</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    return: tuple (atom indices)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    rindex<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    rindexNeighbor<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> atom <span class="kw">in</span> mol.GetAtoms():</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(atom.GetAtomicNum()<span class="op">==</span><span class="dv">0</span>):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            rindex<span class="op">=</span>atom.GetIdx()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            neighbours<span class="op">=</span>atom.GetNeighbors()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="bu">len</span>(neighbours)<span class="op">==</span><span class="dv">1</span>):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                rindexNeighbor<span class="op">=</span>neighbours[<span class="dv">0</span>].GetIdx()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>: </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"two attachment points not supported yet"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>((rindex,rindexNeighbor))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>fragment<span class="op">=</span>Chem.MolFromMolFile(<span class="st">'../data/methyl.mol'</span>,removeHs<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>ret<span class="op">=</span>getAttachmentVector(fragment)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> atom <span class="kw">in</span> mol.GetAtoms():</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        atom.SetAtomMapNum(atom.GetIdx())</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(ret):</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    fragIndex1,fragIndex2<span class="op">=</span>ret</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fragIndex1, fragIndex2)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>mblock <span class="op">=</span> Chem.MolToMolBlock(fragment)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>viewer <span class="op">=</span> py3Dmol.view(width<span class="op">=</span><span class="dv">300</span>, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>viewer.addModel(mblock, <span class="st">'mol'</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>viewer.setStyle({<span class="st">"stick"</span>:{}})</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>viewer.zoomTo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4 1</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_16114413208701591" style="position: relative; width: 300px; height: 300px">
        <p id="3dmolwarning_16114413208701591" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.csb.pitt.edu/build/3Dmol.js');
}

var viewer_16114413208701591 = null;
var warn = document.getElementById("3dmolwarning_16114413208701591");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16114413208701591 = $3Dmol.createViewer($("#3dmolviewer_16114413208701591"),{backgroundColor:"white"});
    viewer_16114413208701591.addModel("\n     RDKit          3D\n\n  5  4  0  0  0  0  0  0  0  0999 V2000\n    0.5288    0.1610    0.9360 H   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.2051    0.8240   -0.6786 H   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3346   -0.9314   -0.4496 H   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0685   -0.0537    0.1922 *   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0\n  2  3  1  0\n  2  4  1  0\n  2  5  1  0\nV    5 *\nM  END\n","mol");
    viewer_16114413208701591.setStyle({"stick": {}});
    viewer_16114413208701591.zoomTo();
viewer_16114413208701591.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>&lt;py3Dmol.view at 0x7f9a40d3b310&gt;</code></pre>
</div>
</div>
<p>Now let’s extract also the atom index of the proton, and also the carbon the proton is attached to on the molecule.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>queryAtomIndex<span class="op">=</span><span class="dv">20</span> <span class="co">#defined by clicking on an atom in the sketcher -&gt; needs to be a proton right now for grafting</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>atom<span class="op">=</span>mol.GetAtomWithIdx(queryAtomIndex)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>neighbours<span class="op">=</span>atom.GetNeighbors()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="bu">len</span>(neighbours)<span class="op">==</span><span class="dv">1</span>):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    rindexNeighbor<span class="op">=</span>neighbours[<span class="dv">0</span>].GetIdx()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>: </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"two attachment points not supported yet"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>molIndex1<span class="op">=</span>queryAtomIndex</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>molIndex2<span class="op">=</span>rindexNeighbor</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(molIndex1,molIndex2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20 9</code></pre>
</div>
</div>
</section>
<section id="aligning-the-fragment-onto-the-molecule" class="level3">
<h3 class="anchored" data-anchor-id="aligning-the-fragment-onto-the-molecule">Aligning the fragment onto the molecule</h3>
<p>Now I have the bond of the carbon to proton selected in the molecule and the carbon to R-group in my fragment. These bonds can be aligned onto each other to position the 3D-fragment correctly versus the molecule. This can be conveniently done using the AlignMol function available in rdkit.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>AlignMol(fragment,mol,atomMap<span class="op">=</span>((fragIndex2,molIndex1),(fragIndex1,molIndex2))) <span class="co">#important to specify the atomMap here, this aligns only the bonds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.027497679760887607</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the rest is just to display things here</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>mblock <span class="op">=</span> Chem.MolToMolBlock(mol)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fragblock <span class="op">=</span> Chem.MolToMolBlock(fragment)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>viewer <span class="op">=</span> py3Dmol.view(width<span class="op">=</span><span class="dv">500</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>viewer.addModel(mblock, <span class="st">'mol'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>viewer.addModel(fragblock, <span class="st">'mol'</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>viewer.setStyle({<span class="st">"stick"</span>:{}})</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>viewer.zoomTo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_16114414054893491" style="position: relative; width: 500px; height: 500px">
        <p id="3dmolwarning_16114414054893491" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.csb.pitt.edu/build/3Dmol.js');
}

var viewer_16114414054893491 = null;
var warn = document.getElementById("3dmolwarning_16114414054893491");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16114414054893491 = $3Dmol.createViewer($("#3dmolviewer_16114414054893491"),{backgroundColor:"white"});
    viewer_16114414054893491.addModel("BRD4, Ligand 1\n     RDKit          3D\n\n 26 28  0  0  0  0  0  0  0  0999 V2000\n    2.7960   -3.1170   11.5320 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5010   -4.1570    9.3850 N   0  0  0  0  0  0  0  0  0  1  0  0\n    3.1660   -3.4780   12.7880 N   0  0  0  0  0  0  0  0  0  2  0  0\n    3.1910   -5.2940   11.4140 N   0  0  0  0  0  0  0  0  0  3  0  0\n    2.4400   -1.8530   11.0440 C   0  0  0  0  0  0  0  0  0  4  0  0\n    2.1160   -1.7280    9.7460 C   0  0  0  0  0  0  0  0  0  5  0  0\n    2.8220   -4.2440   10.7070 C   0  0  0  0  0  0  0  0  0  6  0  0\n    2.1730   -2.9820    8.9350 C   0  0  0  0  0  0  0  0  0  7  0  0\n    1.8140   -2.8670    7.4750 C   0  0  0  0  0  0  0  0  0  8  0  0\n    3.3840   -4.7830   12.6560 C   0  0  0  0  0  0  0  0  0  9  0  0\n    2.4000   -0.6670   11.9180 C   0  0  0  0  0  0  0  0  0 10  0  0\n    3.0530    0.5050   11.5340 C   0  0  0  0  0  0  0  0  0 11  0  0\n    3.0160    1.6280   12.3610 C   0  0  0  0  0  0  0  0  0 12  0  0\n    2.3260    1.5790   13.5730 C   0  0  0  0  0  0  0  0  0 13  0  0\n    1.6740    0.4080   13.9570 C   0  0  0  0  0  0  0  0  0 14  0  0\n    1.7100   -0.7140   13.1300 C   0  0  0  0  0  0  0  0  0 15  0  0\n    1.8440   -0.8220    9.3340 H   0  0  0  0  0  0  0  0  0 16  0  0\n    1.8940   -3.8280    7.0110 H   0  0  0  0  0  0  0  0  0 17  0  0\n    2.4830   -2.1830    6.9960 H   0  0  0  0  0  0  0  0  0 18  0  0\n    0.8100   -2.5080    7.3820 H   0  0  0  0  0  0  0  0  0 19  0  0\n    3.6820   -5.3710   13.4500 H   0  0  0  0  0  0  0  0  0 20  0  0\n    3.5640    0.5410   10.6380 H   0  0  0  0  0  0  0  0  0 21  0  0\n    3.4990    2.4950   12.0770 H   0  0  0  0  0  0  0  0  0 22  0  0\n    2.2980    2.4090   14.1850 H   0  0  0  0  0  0  0  0  0 23  0  0\n    1.1650    0.3720   14.8540 H   0  0  0  0  0  0  0  0  0 24  0  0\n    1.2260   -1.5800   13.4140 H   0  0  0  0  0  0  0  0  0 25  0  0\n  1  3  1  0\n  1  5  1  0\n  1  7  1  0\n  2  7  1  0\n  2  8  2  0\n  3 10  2  0\n  4  7  2  0\n  4 10  1  0\n  5  6  2  0\n  5 11  1  0\n  6  8  1  0\n  6 17  1  0\n  8  9  1  0\n  9 18  1  0\n  9 19  1  0\n  9 20  1  0\n 10 21  1  0\n 11 12  2  0\n 11 16  1  0\n 12 13  1  0\n 12 22  1  0\n 13 14  2  0\n 13 23  1  0\n 14 15  1  0\n 14 24  1  0\n 15 16  2  0\n 15 25  1  0\n 16 26  1  0\nM  END\n","mol");
    viewer_16114414054893491.addModel("\n     RDKit          3D\n\n  5  4  0  0  0  0  0  0  0  0999 V2000\n    4.6999   -5.7482   13.2952 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.6899   -5.3867   13.4712 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0141   -6.2323   13.5694 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.6697   -4.7987   14.3852 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.3761   -4.7673   12.6348 *   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0\n  2  3  1  0\n  2  4  1  0\n  2  5  1  0\nV    5 *\nM  END\n","mol");
    viewer_16114414054893491.setStyle({"stick": {}});
    viewer_16114414054893491.zoomTo();
viewer_16114414054893491.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>&lt;py3Dmol.view at 0x7f9a80a95e10&gt;</code></pre>
</div>
</div>
<p>As you can see, the fragment gets placed correctly on top of the proton. Now we have however a few overlapping atoms in place. We can use the rdkit edition functions to address this and combine both overlapping molecules now into a final single molecule.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connectMols(mol1, mol2, atom1, atom2):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""function copied from here https://github.com/molecularsets/moses/blob/master/moses/baselines/combinatorial.py"""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        combined <span class="op">=</span> Chem.CombineMols(mol1, mol2)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        emol <span class="op">=</span> Chem.EditableMol(combined)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        neighbor1_idx <span class="op">=</span> atom1.GetNeighbors()[<span class="dv">0</span>].GetIdx()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        neighbor2_idx <span class="op">=</span> atom2.GetNeighbors()[<span class="dv">0</span>].GetIdx()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        atom1_idx <span class="op">=</span> atom1.GetIdx()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        atom2_idx <span class="op">=</span> atom2.GetIdx()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        bond_order <span class="op">=</span> atom2.GetBonds()[<span class="dv">0</span>].GetBondType()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        emol.AddBond(neighbor1_idx,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                     neighbor2_idx <span class="op">+</span> mol1.GetNumAtoms(),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                     order<span class="op">=</span>bond_order)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        emol.RemoveAtom(atom2_idx <span class="op">+</span> mol1.GetNumAtoms())</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        emol.RemoveAtom(atom1_idx)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        mol <span class="op">=</span> emol.GetMol()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mol </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>finalMol<span class="op">=</span>connectMols(mol,fragment,mol.GetAtomWithIdx(molIndex1),fragment.GetAtomWithIdx(fragIndex1))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>Chem.SanitizeMol(finalMol)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>finalMolBlock <span class="op">=</span> Chem.MolToMolBlock(finalMol)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>viewer <span class="op">=</span> py3Dmol.view(width<span class="op">=</span><span class="dv">500</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>viewer.addModel(finalMolBlock, <span class="st">'mol'</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>viewer.setStyle({<span class="st">"stick"</span>:{}})</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>viewer.zoomTo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="3dmolviewer_16114414154421601" style="position: relative; width: 500px; height: 500px">
        <p id="3dmolwarning_16114414154421601" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.csb.pitt.edu/build/3Dmol.js');
}

var viewer_16114414154421601 = null;
var warn = document.getElementById("3dmolwarning_16114414154421601");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16114414154421601 = $3Dmol.createViewer($("#3dmolviewer_16114414154421601"),{backgroundColor:"white"});
    viewer_16114414154421601.addModel("BRD4, Ligand 1\n     RDKit          3D\n\n 29 31  0  0  0  0  0  0  0  0999 V2000\n    2.7960   -3.1170   11.5320 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5010   -4.1570    9.3850 N   0  0  0  0  0  0  0  0  0  1  0  0\n    3.1660   -3.4780   12.7880 N   0  0  0  0  0  0  0  0  0  2  0  0\n    3.1910   -5.2940   11.4140 N   0  0  0  0  0  0  0  0  0  3  0  0\n    2.4400   -1.8530   11.0440 C   0  0  0  0  0  0  0  0  0  4  0  0\n    2.1160   -1.7280    9.7460 C   0  0  0  0  0  0  0  0  0  5  0  0\n    2.8220   -4.2440   10.7070 C   0  0  0  0  0  0  0  0  0  6  0  0\n    2.1730   -2.9820    8.9350 C   0  0  0  0  0  0  0  0  0  7  0  0\n    1.8140   -2.8670    7.4750 C   0  0  0  0  0  0  0  0  0  8  0  0\n    3.3840   -4.7830   12.6560 C   0  0  0  0  0  0  0  0  0  9  0  0\n    2.4000   -0.6670   11.9180 C   0  0  0  0  0  0  0  0  0 10  0  0\n    3.0530    0.5050   11.5340 C   0  0  0  0  0  0  0  0  0 11  0  0\n    3.0160    1.6280   12.3610 C   0  0  0  0  0  0  0  0  0 12  0  0\n    2.3260    1.5790   13.5730 C   0  0  0  0  0  0  0  0  0 13  0  0\n    1.6740    0.4080   13.9570 C   0  0  0  0  0  0  0  0  0 14  0  0\n    1.7100   -0.7140   13.1300 C   0  0  0  0  0  0  0  0  0 15  0  0\n    1.8440   -0.8220    9.3340 H   0  0  0  0  0  0  0  0  0 16  0  0\n    1.8940   -3.8280    7.0110 H   0  0  0  0  0  0  0  0  0 17  0  0\n    2.4830   -2.1830    6.9960 H   0  0  0  0  0  0  0  0  0 18  0  0\n    0.8100   -2.5080    7.3820 H   0  0  0  0  0  0  0  0  0 19  0  0\n    3.5640    0.5410   10.6380 H   0  0  0  0  0  0  0  0  0 21  0  0\n    3.4990    2.4950   12.0770 H   0  0  0  0  0  0  0  0  0 22  0  0\n    2.2980    2.4090   14.1850 H   0  0  0  0  0  0  0  0  0 23  0  0\n    1.1650    0.3720   14.8540 H   0  0  0  0  0  0  0  0  0 24  0  0\n    1.2260   -1.5800   13.4140 H   0  0  0  0  0  0  0  0  0 25  0  0\n    4.6999   -5.7482   13.2952 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.6899   -5.3867   13.4712 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0141   -6.2323   13.5694 H   0  0  0  0  0  0  0  0  0  0  0  0\n    3.6697   -4.7987   14.3852 H   0  0  0  0  0  0  0  0  0  0  0  0\n  1  3  1  0\n  1  5  1  0\n  1  7  1  0\n  2  7  1  0\n  2  8  2  0\n  3 10  2  0\n  4  7  2  0\n  4 10  1  0\n  5  6  2  0\n  5 11  1  0\n  6  8  1  0\n  6 17  1  0\n  8  9  1  0\n  9 18  1  0\n  9 19  1  0\n  9 20  1  0\n 11 12  2  0\n 11 16  1  0\n 12 13  1  0\n 12 21  1  0\n 13 14  2  0\n 13 22  1  0\n 14 15  1  0\n 14 23  1  0\n 15 16  2  0\n 15 24  1  0\n 16 25  1  0\n 26 27  1  0\n 27 28  1  0\n 27 29  1  0\n 10 27  1  0\nM  END\n","mol");
    viewer_16114414154421601.setStyle({"stick": {}});
    viewer_16114414154421601.zoomTo();
viewer_16114414154421601.render();
});
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>&lt;py3Dmol.view at 0x7f9a80a8b790&gt;</code></pre>
</div>
</div>
<p>And voilà. Our methyl is nicely placed and oriented. That’s one of the easiest cases and we’ll have to consider torsion angles &amp; protein environment at a later stage as well, but this should provide first basic steps for simple additions like the one done here.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>