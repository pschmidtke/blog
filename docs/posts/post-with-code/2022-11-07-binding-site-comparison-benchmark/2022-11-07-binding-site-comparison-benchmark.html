<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-11-07">
<meta name="description" content="A (long) comment on current pitfalls on binding site comparison papers &amp; their benchmarking">

<title>Spinning coral - Binding site comparison - current benchmark issues</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Spinning coral</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pschmidtke" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://masto.ai/(pschmidtke?)" rel="" target=""><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Binding site comparison - current benchmark issues</h1>
                  <div>
        <div class="description">
          A (long) comment on current pitfalls on binding site comparison papers &amp; their benchmarking
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">binding site</div>
                <div class="quarto-category">pocket</div>
                <div class="quarto-category">cavity</div>
                <div class="quarto-category">pocket comparison</div>
                <div class="quarto-category">structure-based drug design</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 7, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a>
  <ul class="collapse">
  <li><a href="#what-is-binding-site-comparison" id="toc-what-is-binding-site-comparison" class="nav-link" data-scroll-target="#what-is-binding-site-comparison">What is binding site comparison?</a></li>
  <li><a href="#existing-literature" id="toc-existing-literature" class="nav-link" data-scroll-target="#existing-literature">Existing literature</a>
  <ul class="collapse">
  <li><a href="#prospeccts" id="toc-prospeccts" class="nav-link" data-scroll-target="#prospeccts">Prospeccts</a></li>
  <li><a href="#tough-dataset" id="toc-tough-dataset" class="nav-link" data-scroll-target="#tough-dataset">TOUGH dataset</a></li>
  <li><a href="#kahraman-dataset" id="toc-kahraman-dataset" class="nav-link" data-scroll-target="#kahraman-dataset">Kahraman dataset</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#similar-binding-sites-bind-similar-ligands-and-vice-versa" id="toc-similar-binding-sites-bind-similar-ligands-and-vice-versa" class="nav-link" data-scroll-target="#similar-binding-sites-bind-similar-ligands-and-vice-versa">Similar binding sites bind similar ligands and vice versa</a></li>
  <li><a href="#a-few-current-benchmark-datasets" id="toc-a-few-current-benchmark-datasets" class="nav-link" data-scroll-target="#a-few-current-benchmark-datasets">A few current benchmark datasets</a>
  <ul class="collapse">
  <li><a href="#a-quick-peek-into-the-tough-m1-dataset" id="toc-a-quick-peek-into-the-tough-m1-dataset" class="nav-link" data-scroll-target="#a-quick-peek-into-the-tough-m1-dataset">A quick peek into the TOUGH-M1 dataset</a>
  <ul class="collapse">
  <li><a href="#a-bit-of-code" id="toc-a-bit-of-code" class="nav-link" data-scroll-target="#a-bit-of-code">A bit of code</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#how-about-prospeccts" id="toc-how-about-prospeccts" class="nav-link" data-scroll-target="#how-about-prospeccts">How about Prospeccts</a>
  <ul class="collapse">
  <li><a href="#dataset-1" id="toc-dataset-1" class="nav-link" data-scroll-target="#dataset-1">Dataset 1</a></li>
  <li><a href="#dataset-7" id="toc-dataset-7" class="nav-link" data-scroll-target="#dataset-7">Dataset 7</a></li>
  <li><a href="#how-about-the-barelier-dataset" id="toc-how-about-the-barelier-dataset" class="nav-link" data-scroll-target="#how-about-the-barelier-dataset">How about the Barelier dataset</a></li>
  <li><a href="#class-a-molecules" id="toc-class-a-molecules" class="nav-link" data-scroll-target="#class-a-molecules">Class A molecules</a></li>
  <li><a href="#class-b-molecules" id="toc-class-b-molecules" class="nav-link" data-scroll-target="#class-b-molecules">Class B molecules</a></li>
  <li><a href="#class-c-molecules" id="toc-class-c-molecules" class="nav-link" data-scroll-target="#class-c-molecules">Class C molecules</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#general-note" id="toc-general-note" class="nav-link" data-scroll-target="#general-note">General Note</a></li>
  <li><a href="#similar-folds-contain-similar-binding-sites" id="toc-similar-folds-contain-similar-binding-sites" class="nav-link" data-scroll-target="#similar-folds-contain-similar-binding-sites">Similar folds contain similar binding sites</a></li>
  <li><a href="#perspective" id="toc-perspective" class="nav-link" data-scroll-target="#perspective">Perspective</a>
  <ul class="collapse">
  <li><a href="#what-is-obviously-similar-should-be-retrieved-first" id="toc-what-is-obviously-similar-should-be-retrieved-first" class="nav-link" data-scroll-target="#what-is-obviously-similar-should-be-retrieved-first">What is obviously similar should be retrieved first</a></li>
  <li><a href="#what-is-objectively-similar" id="toc-what-is-objectively-similar" class="nav-link" data-scroll-target="#what-is-objectively-similar">What is objectively similar</a></li>
  <li><a href="#totally-unrelated-proteins" id="toc-totally-unrelated-proteins" class="nav-link" data-scroll-target="#totally-unrelated-proteins">Totally unrelated proteins</a></li>
  <li><a href="#no-explicit-definition-of-decoys" id="toc-no-explicit-definition-of-decoys" class="nav-link" data-scroll-target="#no-explicit-definition-of-decoys">No explicit definition of decoys</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="intro" class="level1">
<h1>Intro</h1>
<p>First of all, what is written here is my personal viewpoint on the matter. It is conceivable that other people might have different opinions on this topic ;)</p>
<p>There has been a lot of interest on the comparison (in 3D) of binding sites since initiating work in that scope by <a href="https://www.theses.fr/2003LYO10075">Jambon et al</a>. Today several methods exist, some of them freely available and some of them … not. I also got sucked into the field by the end of my PhD but never ended writing up papers about the whole topic. There are several reasons for that. The main one is likely laziness and total frustration with the scientific publishing &amp; reviewing process. So now I decided to write things up gradually here and maybe one day I’ll spend some time shaping that into a paper ;) This post is mainly about the shortcomings in the way these algorithms are generally validated &amp; intends to challenge currently accepted benchmark datasets in the field. <em>NB:</em> my focus here is to validate at some point my own algorithms, but given the state of the art, a bit of work on the datasets themselves is in order! Also, I’m focusing on how can such binding site methods be applied in the context of drug-discovery when sieving through all structural information available within resources like the RCSB PDB or a model database, like Alphafold or derivatives.</p>
<section id="what-is-binding-site-comparison" class="level2">
<h2 class="anchored" data-anchor-id="what-is-binding-site-comparison">What is binding site comparison?</h2>
<p>In its simplest form, the fact to be able to compare two pockets from two structures and assess to what extent they are similar. I guess you can already see the various pitfalls in this definition. Binding site comparison could have some rather nice applications when applied on a larger scale (compare one or multiple binding sites to millions of others) in order to identify potential off-targets (or promiscuity prediction) or chemical matter that might bind in such an environment (drug repurposing or bioisosteric replacements, fragment based designs etc …). Comparing binding sites is not a trivial task and the perception on how this should be done can vary significantly depending on the use-case or mind-set at hand. Here are some potential use cases that require dedicated datasets &amp; validation: - idea generation in drug discovery (hit id &amp; lead opt) - polypharmacology prediction (toxicology) - protein function prediction</p>
</section>
<section id="existing-literature" class="level2">
<h2 class="anchored" data-anchor-id="existing-literature">Existing literature</h2>
<p>Today there are a lot of papers published on that topic. As usual with method development papers in science, with them a ton of ways proving that the authors’ method is for sure always the best one compared to a small selected set of the other existing ones … The field of binding site comparison lacked for a very long time a throuroughly built &amp; commonly accepted benchmark dataset and this for various reasons. But in the end, we end up with the typical mess with a ton of methods each better than the other but not really comparable nor compared to one another.</p>
<section id="prospeccts" class="level3">
<h3 class="anchored" data-anchor-id="prospeccts">Prospeccts</h3>
<p>A recent (well now not so recent anymore …) review article by Christiane Ehrt, Tobias Brinkhorst &amp; Oliver Koch tries to address some of the historical shortcomings in the field. They summarize some approaches known today (not extensive, but representative). You can find them in table 1 of the paper by <span class="citation" data-cites="Ehrt2018">Ehrt, Brinkjost, and Koch (<a href="#ref-Ehrt2018" role="doc-biblioref">2018</a>)</span>. I fully understand that benchmarking a posteriori tens of different methods &amp; developers must be daunting task &amp; am really grateful the team tackled such an effort.</p>
<p>The paper reuses / discusses some of the older datasets in the litterature, and I’ll cover mainly two of the ones used by the authors.</p>
<p>Ehrt et al also touch upon a different topic in that paper: a dataset to benchmark a method depends on the scope of capabilities you want to test your method on. That’s a reality that was simply absent from validations before. If you want to prove that your method is capable of detecting remote relationships between binding sites on very different proteins known to bind similar ligands (or not), you have to actually validate that on a relevant dataset.</p>
</section>
<section id="tough-dataset" class="level3">
<h3 class="anchored" data-anchor-id="tough-dataset">TOUGH dataset</h3>
<p>Original paper from <span class="citation" data-cites="Govindaraj2018">Govindaraj and Brylinski (<a href="#ref-Govindaraj2018" role="doc-biblioref">2018</a>)</span>. This dataset was introduced by Govindaraj &amp; Brylinski the same year as the publication of prospeccts. It is an interesting one, because it focuses on one of the “dreams” in the binding site comparison community: “Two very different binding sites known to bind a similar ligand, must be to some extent similar”. I’ll come to that statement a bit later. Basically their viewpoint is that some of the previous studies had performances published that were too good, because the underlying protein structures used in the binding site comparison evaluation were too similar.</p>
<p>So they set up a process to generate a more challenging (“tough”) dataset for such methods as described in <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-018-2109-2/figures/1">figure 1 of that paper</a> from <span class="citation" data-cites="Govindaraj2018">Govindaraj and Brylinski (<a href="#ref-Govindaraj2018" role="doc-biblioref">2018</a>)</span></p>
<p>I’m currently still trying to wrap my head around the actual procedure and its potential advantages &amp; drawbacks but have to admit that the process is as so often not reproducible as is. So one has to live with the dataset established in 2018, which itself also difficult to reproduce for reasons I won’t elaborate further - but a few <a href="https://github.com/BenevolentAI/DeeplyTough/blob/master/datasets_downloader.sh">lines of code from a paper about deeplytough from benevolent</a> actually helped to get to the actual dataset at least.</p>
</section>
<section id="kahraman-dataset" class="level3">
<h3 class="anchored" data-anchor-id="kahraman-dataset">Kahraman dataset</h3>
<p>Paper by <span class="citation" data-cites="Kahraman2009">Kahraman et al. (<a href="#ref-Kahraman2009" role="doc-biblioref">2009</a>)</span>. That’s historically the most used &amp; cited one in the field and it was developed for a totally different purpose. To highlight that, find here the abstract from that paper: &gt; Most function prediction methods that identify cognate ligands from binding site analyses work on the assumption of molecular complementarity. <strong>These approaches build on the conjectured complementarity of geometrical and physicochemical properties between ligands and binding sites so that similar binding sites will bind similar ligands. We found that this assumption does not generally hold for protein–ligand interactions</strong> and observed that it is not the chemical composition of ligand molecules that dictates the complementarity between protein and ligand molecules, but that the ligand’s share within the functional mechanism of a protein determines the degree of complementarity. Here, we present for a set of cognate ligands a descriptive analysis and comparison of the physicochemical properties that each ligand experiences in various nonhomologous binding pockets. The comparisons in each ligand set reveal large variations in their experienced physicochemical properties, suggesting that the same ligand can bind to distinct physicochemical environments. In some protein ligand complexes, the variation was found to correlate with the electrochemical characteristic of ligand molecules, whereas in others it was disclosed as a prerequisite for the biochemical function of the protein. To achieve binding, proteins were observed to engage in subtle balancing acts between electrostatic and hydrophobic interactions to generate stabilizing free energies of binding. For the presented analysis, a new method for scoring hydrophobicity from molecular environments was developed showing high correlations with experimental determined desolvation energies. The presented results highlight the complexities of molecular recognition and underline the challenges of computational structural biology in developing methods to detect these important subtleties.</p>
<p>How on earth did this end up as benchmark dataset for binding site comparison? The conclusions of that paper are a very interesting read and if you have the chance to have access to the paper I invite you to read them.</p>
</section>
</section>
</section>
<section id="similar-binding-sites-bind-similar-ligands-and-vice-versa" class="level1">
<h1>Similar binding sites bind similar ligands and vice versa</h1>
<p>The titel of this section summarizes a general assumption in the field for validating binding site comparison algorithms.</p>
<p>Let me list a few citations here to clarify my point: &gt; Our approach makes the basic assumption that proteins which bind similar ligands have clefts of similar size, shape and chemistry. from <a href="https://academic.oup.com/bioinformatics/article/21/10/2347/206780"><span class="citation" data-cites="Morris2005">Morris et al. (<span>2005</span>)</span></a> and the authors of the Kahraman paper above …</p>
<blockquote class="blockquote">
<p>Similarity in ligand binding sites can indicate common binding modes and recognition of similar molecules … from <a href="https://www.sciencedirect.com/science/article/abs/pii/S0022283605014452"><span class="citation" data-cites="Gold2006">Gold and Jackson (<span>2006</span>)</span></a></p>
</blockquote>
<blockquote class="blockquote">
<p>Assuming that similar ligands bind to similar cavities, function and ligands for a novel protein may be inferred from structurally similar liganded cavities from <a href="https://pubs.acs.org/doi/10.1021/ci900349y"><span class="citation" data-cites="Weill2010">Weill and Rognan (<span>2010</span>)</span></a></p>
</blockquote>
<p>And there are many more. Interestingly, this statement has been the basis to establish some of the first binding site comparison benchmarks used in the litterature and the example cited about the TOUGH dataset above.</p>
<p>This results in a very early and widely used benchmark dataset of 40 structures binding either a steroid, NAD, ATP and heme groups. You can already imagine that in terms of applications to drug-discovery this might be of limited interest. What is more disturbing to me here, establishing these sets (and others around the same principle), is that if a protein binds the same ligand, its binding site should be somehow related / similar to some extent. Yes in some cases that’s true, but using it as a ground truth statement is an oversimplification.</p>
<p>According to what we know so far (or at least that’s how I understood it), a <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6680532/">binding site can be promiscuous</a> (<span class="citation" data-cites="Cerisier2019">Cerisier et al. (<a href="#ref-Cerisier2019" role="doc-biblioref">2019</a>)</span>) and ligands can be promiscuous as well. There are very well known examples of proteins binding a whole range of ligands even though their binding sites have nothing in common with the intended target in the drug discovery project. Take for instance the HERG channel or CYP P450 … all of them are able to bind a variety of ligands despite the disimilarity of their binding sites compared to the intended targets. Another hallmark of such promiscuous binding sites is their hydrophobicity and presence of short sidechains in the binding vicinity (Cerisier et al cited above) - this poses particular challenges to binding site comparison methods as stated as well by Ehrt et al.&nbsp;And these are only unwanted off-targets we know about because they impede on how you imagine your drug interacts inside and outside the cell.</p>
<p>On the other hand, ligands can also expose particular functional groups that yield either very specific interactions and thus a narrow biological profile (hitting only a few targets), or on the contrary, they can bind on a large variety of binding sites of different proteins (frequent hitters, promiscuous binders and all of the molecules in the shadow zone in between promiscuous and specific).</p>
<p>Also, in order to establish datasets based on this assumption one requires the actual data, so reliable structures with compound A in target X and a similar compound B in totally different target Y and their exact location of interaction. If your compound B has a very narrow biological footprint (hits only a few targets specifically) then you might be lucky. However, if your compound B is a frequent hitter then what is the relevance of that relation? You’d associate target X to a whole lot of other targets hit by a promiscuous compound.</p>
<p>When using binding site comparison methods in the scope of protein function prediction such approximation might be relevant or event wanted. However I doubt they should have such a high relevance in the scope of drug discovery applications.</p>
<p>A paper that sets all of this a bit more in the perspective of drug discovery was written <a href="https://pubs.acs.org/doi/10.1021/acschembio.5b00683"><span class="citation" data-cites="Barelier2015">Barelier et al. (<span>2015</span>)</span></a>. But even there one can observe important shortcomings.</p>
</section>
<section id="a-few-current-benchmark-datasets" class="level1">
<h1>A few current benchmark datasets</h1>
<section id="a-quick-peek-into-the-tough-m1-dataset" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-peek-into-the-tough-m1-dataset">A quick peek into the TOUGH-M1 dataset</h2>
<p>The paper introducing the TOUGH dataset didn’t include a single figure showing what types of binding sites &amp; thus ligands were selected to establish the benchmark dataset. So to get a glimpse of that here I’ll show a set of the most common clusters of molecules in their “positive” dataset, so a set of binding sites to be compared to others binding similar ligands.</p>
<section id="a-bit-of-code" class="level3">
<h3 class="anchored" data-anchor-id="a-bit-of-code">A bit of code</h3>
<p>Let’s read in the positive list from the TOUGH-M1 dataset and read all sd files available in the distributed version of the dataset.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prerequisit: get the zip file and unzip to a folder of your choice: wget https://dataverse.harvard.edu/api/access/datafile/:persistentId?persistentId=doi:10.7910/DVN/L7H7JJ/UFO5CB </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get the positive list from the TOUGH-M1 set from the SI of the paper itself</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> RDLogger</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> RDLogger.logger()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>lg.setLevel(RDLogger.CRITICAL)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>positiveList<span class="op">=</span>pd.read_csv(<span class="st">"/Users/peter/Downloads/TOUGH-M1_positive.list"</span>,delim_whitespace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>uniquePdbCodes<span class="op">=</span>positiveList.iloc[:, <span class="dv">0</span>].unique()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Number of distinct PDB structures: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">len</span>(uniquePdbCodes)))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>molecules<span class="op">=</span>[]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pdbCode <span class="kw">in</span> uniquePdbCodes:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    sdFilePath<span class="op">=</span><span class="st">'/Users/peter/Downloads/TOUGH-M1_dataset/'</span><span class="op">+</span>pdbCode<span class="op">+</span><span class="st">'/'</span><span class="op">+</span>pdbCode<span class="op">+</span><span class="st">'00.sdf'</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mol <span class="kw">in</span> Chem.SDMolSupplier(sdFilePath,removeHs<span class="op">=</span><span class="va">False</span>,sanitize<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mol:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            mol.RemoveAllConformers()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            molecules.append(mol)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Read </span><span class="sc">{}</span><span class="st"> molecules"</span>.<span class="bu">format</span>(<span class="bu">len</span>(molecules)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of distinct PDB structures: 5965
Read 5917 molecules</code></pre>
</div>
</div>
<p>First of all you notice that a few molecules cannot be read. I won’t go too much into detail, but feel free to peek in here which ones these are &amp; how this could happen. Now let’s do a very basic clustering just to get a rough idea on what the dataset looks like.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> AllChem</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Define clustering setup</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ClusterFps(fps,cutoff<span class="op">=</span><span class="fl">0.2</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rdkit <span class="im">import</span> DataStructs</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rdkit.ML.Cluster <span class="im">import</span> Butina</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># first generate the distance matrix:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    dists <span class="op">=</span> []</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    nfps <span class="op">=</span> <span class="bu">len</span>(fps)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,nfps):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        sims <span class="op">=</span> DataStructs.BulkTanimotoSimilarity(fps[i],fps[:i])</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        dists.extend([<span class="dv">1</span><span class="op">-</span>x <span class="cf">for</span> x <span class="kw">in</span> sims])</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    cs <span class="op">=</span> Butina.ClusterData(dists,nfps,cutoff,isDistData<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cs</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>fps <span class="op">=</span> [AllChem.GetMorganFingerprintAsBitVect(mol,<span class="dv">2</span>,<span class="dv">1024</span>) <span class="cf">for</span> mol <span class="kw">in</span> molecules <span class="cf">if</span> mol]</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>clusters<span class="op">=</span>ClusterFps(fps,cutoff<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>clusterSizes<span class="op">=</span>np.array([<span class="bu">len</span>(cluster) <span class="cf">for</span> cluster <span class="kw">in</span> clusters])</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>sortedClusterIndices<span class="op">=</span>np.argsort(clusterSizes)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>selectedSizes<span class="op">=</span>clusterSizes[sortedClusterIndices]</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Draw</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>mols<span class="op">=</span>[molecules[clusters[sortedClusterIndices[idx]][<span class="dv">0</span>]] <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">50</span>)]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>legend<span class="op">=</span>[<span class="st">"Cluster "</span><span class="op">+</span><span class="bu">str</span>(sortedClusterIndices[idx])<span class="op">+</span><span class="st">" - "</span><span class="op">+</span><span class="bu">str</span>(s) <span class="cf">for</span> idx,s <span class="kw">in</span> <span class="bu">enumerate</span>(selectedSizes[:<span class="dv">50</span>])]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(mols,molsPerRow<span class="op">=</span><span class="dv">5</span>,legends<span class="op">=</span>legend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<p><img src="2022-11-07-binding-site-comparison-benchmark_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is a bit of code if you want ot get a peek into each cluster, did that but won't show the results. Overall they look fairly clean: </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#mols=[molecules[clusters[sortedClusterIndices[0]][idx]] for idx in range(0,50)]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw.MolsToGridImage(mols,molsPerRow=5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>The majority of the dataset is composed of nucleotides /-sides, sugars &amp; derivatives … ah and hemes. We can also find what we usually would consider as crystallographic surfactants, very small fragments, and a few lipids as well. In other words, the overall composition of the dataset appears to be somehow close to the Kahraman dataset despite being on a different scale (5000 structures versus 40 roughly). Here again I’d argue that such a dataset is useful in the scope of protein function prediction, but I doubt it’s the best suited for drug discovery.</p>
</section>
</section>
<section id="how-about-prospeccts" class="level2">
<h2 class="anchored" data-anchor-id="how-about-prospeccts">How about Prospeccts</h2>
<p>During my binding site comparison tests, I also played a bit more in detail with the Prospeccts dataset 1 &amp; 7.</p>
<section id="dataset-1" class="level3">
<h3 class="anchored" data-anchor-id="dataset-1">Dataset 1</h3>
<p>It tries to give indicators on how sensitive a comparison method is towards the binding site definition itself. It’s composed of 12 different protein binding sites that can be identified relatively easily with the <a href="https://storage.googleapis.com/plos-corpus-prod/10.1371/journal.pcbi.1006483/1/pcbi.1006483.s010.pdf?X-Goog-Algorithm=GOOG4-RSA-SHA256&amp;X-Goog-Credential=wombat-sa%40plos-prod.iam.gserviceaccount.com%2F20221106%2Fauto%2Fstorage%2Fgoog4_request&amp;X-Goog-Date=20221106T073322Z&amp;X-Goog-Expires=86400&amp;X-Goog-SignedHeaders=host&amp;X-Goog-Signature=719810aab372ff2cbe88c088c55eb37b8c981bf5005584748394f7d101403fdc664b3c849562a63bd1a829b834e12d3a7726c6916fb2896efbbb6dfaa32a1606baa03258e19966215d211318fc07e53ad85b939fa63136adaee48278ef849859eea92e63554c9bc041fabd3492c9b3515df36224e3aa20fb7db77486f84b8e94f26e03ba7ee3d1f82c022bd6254d1a4fe981485528a49bc63d3104c477b2c6836bac14fc8678844fb2128cef67d9627b826c425dbccc9aa1b016a54c3021b0520a330733e68248aba57a74126f03d2ab51de0e596c0778055b6452432219f51eda4e87dcb825c6a6c7ac62f7349f8d047280eaa874feb00452c9abdf8e9e6e47">table S9</a> from supporting information. Several structures are available for each binding site and a binding site comparison algorithm should ideally be able to identify binding sites of the same protein with higher similarities than binding sites of the other proteins of the dataset (used as decoy here). The authors state, that “It was generated to evaluate the sensitivity of binding site comparison tools with respect to the binding site definition. A tool which is not able to enrich similar binding sites accommodating different ligands should not be applied for drug repurposing projects or the prediction of putative off-targets”. The second sentence, does not really apply for this dataset in my opinion. I used this kind of approach though to test if naturally a binding site comparison method is able to enrich results (from a huge heterogeneous set of pockets) with binding sites from the same protein (same location) or protein family, or orthologs. Ehrt et al argue that the benchmark set depend on the purpose of the binding site comparison sofware and that’s true. Datasets like the dataset 1 from the Prospeccts paper allow first of all to check if there is some reasonable signal in identifying similar binding sites. I’m saying binding sites, not interaction patterns (!!!). As such, dataset 1 &amp; thoroughly built extensions of these can be used to evaluate if a binding site comparison method could be used also as idea generator and for validation of off-target identification scenarios (but there aren’t any in dataset 1 as for now).</p>
</section>
<section id="dataset-7" class="level3">
<h3 class="anchored" data-anchor-id="dataset-7">Dataset 7</h3>
<p><a href="https://storage.googleapis.com/plos-corpus-prod/10.1371/journal.pcbi.1006483/1/pcbi.1006483.s012.pdf?X-Goog-Algorithm=GOOG4-RSA-SHA256&amp;X-Goog-Credential=wombat-sa%40plos-prod.iam.gserviceaccount.com%2F20221107%2Fauto%2Fstorage%2Fgoog4_request&amp;X-Goog-Date=20221107T053127Z&amp;X-Goog-Expires=86400&amp;X-Goog-SignedHeaders=host&amp;X-Goog-Signature=2ddce370892bc7f82b0acee1b16f4c3fc52d75303aa3948aae2dd43b40959567f8e9b8f50bc0b24247d26454207bab10d7c47f24a0b59eb6569468480ebd2d4d3e8293ba0d1a193aa0af7fe317273142e3b188837d75eb10e8cdacbff978b77c389cd32641de723b314c6ce72ac517b023488d8728cc27b06e71b811af8932e5b2afdabb9c1a9ae073df8dfba23cc22e6ce092ff71308bf7ad6d3433287ca6f446fd6a72957effef4c42ce1205ac7166849f855f2969eb37985cebc1411fb93d64367b457b22053453b646230ed3a1cdd1aeab7f5f9f829b8bcf4d964fac0ad4ac71870623a2b3ace090964f4c1d761a916d18cc554feea3bfaf79e435e1eb87">This dataset from the prospeccts paper</a> from <span class="citation" data-cites="Ehrt2018">Ehrt, Brinkjost, and Koch (<a href="#ref-Ehrt2018" role="doc-biblioref">2018</a>)</span> is one of these examples where you say, on paper that looks great and about what we need. But once looking into the details, it’s again rather small and there are a few very worrying errors in it as well (i.e.&nbsp;two PIM kinase ATP binding sites as decoy pair, a lot of NAD / FAD binding sites etc).</p>
</section>
<section id="how-about-the-barelier-dataset" class="level3">
<h3 class="anchored" data-anchor-id="how-about-the-barelier-dataset">How about the Barelier dataset</h3>
<p>Let’s check out <span class="citation" data-cites="Barelier2015">Barelier et al. (<a href="#ref-Barelier2015" role="doc-biblioref">2015</a>)</span> <a href="https://pubs.acs.org/doi/10.1021/acschembio.5b00683">dataset</a>, which again is supposed to give us a few examples where the same or similar ligands bind to very different proteins. Again this is used throughout the binding site comparison community as valid benchmark dataset. The set is rather small, so I’ll just display the chemical matter that has been used here. The Barelier set is also used within the prospeccts paper. The molecules were extracted from the residue codes available in table1 SI - class A (ligands make similar interactions in related residues in both binding sites), table 2 SI - class B (same ligand groups interact with dissimilar residues &amp; environments)), table 3 SI - class C (different parts of the ligand interacts).</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> AllChem</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#I love copying codes from PDF's, ACS, you cannot imagine how painful this is</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>classA<span class="op">=</span>[<span class="st">"2AN"</span>,<span class="st">"3IP"</span>,<span class="st">"ACD"</span>,<span class="st">"AEF"</span>,<span class="st">"AGI"</span>,<span class="st">"AMZ"</span>,<span class="st">"BRN"</span>,<span class="st">"CAU"</span>,<span class="st">"DAO"</span>,<span class="st">"CXX"</span>,<span class="st">"EIC"</span>,<span class="st">"FLN"</span>,<span class="st">"GNT"</span>,<span class="st">"HXA"</span>,<span class="st">"IBP"</span>,<span class="st">"NTZ"</span>,<span class="st">"VCA"</span>,<span class="st">"X8Z"</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>classB<span class="op">=</span>[<span class="st">"0YN"</span>,<span class="st">"IGP"</span>,<span class="st">"1QK"</span>,<span class="st">"4AX"</span>,<span class="st">"4HP"</span>,<span class="st">"4NP"</span>,<span class="st">"ALE"</span>,<span class="st">"BIO"</span>,<span class="st">"C2R"</span>,<span class="st">"CEL"</span>,<span class="st">"CFF"</span>,<span class="st">"CPB"</span>,<span class="st">"CSN"</span>,<span class="st">"DHF"</span>,<span class="st">"XDE"</span>,<span class="st">"EMO"</span>,<span class="st">"ES1"</span>,<span class="st">"FUN"</span>,<span class="st">"H2B"</span>,<span class="st">"IAC"</span>,<span class="st">"LOC"</span>,<span class="st">"LVA"</span>,<span class="st">"MTE"</span>,<span class="st">"MYC"</span>,<span class="st">"NAR"</span>,<span class="st">"OCA"</span>,<span class="st">"PDN"</span>,<span class="st">"PT1"</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>classC<span class="op">=</span>[<span class="st">"16A"</span>,<span class="st">"2AL"</span>,<span class="st">"2TN"</span>,<span class="st">"3PO"</span>,<span class="st">"AIN"</span>,<span class="st">"AZM"</span>,<span class="st">"BER"</span>,<span class="st">"CLM"</span>,<span class="st">"EMU"</span>,<span class="st">"FLF"</span>,<span class="st">"IAC"</span>,<span class="st">"LUM"</span>,<span class="st">"PHN"</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getMoleculesFromRcsb(residueCode):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    response<span class="op">=</span>requests.get(<span class="st">"https://data.rcsb.org/rest/v1/core/chemcomp/"</span><span class="op">+</span>residueCode)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(response.status_code<span class="op">==</span>requests.codes.ok):</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        d<span class="op">=</span>json.loads((response.text))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        smiles<span class="op">=</span>d[<span class="st">"rcsb_chem_comp_descriptor"</span>][<span class="st">"smiles"</span>]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(Chem.MolFromSmiles(smiles))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>classAmolecules<span class="op">=</span>[getMoleculesFromRcsb(residue) <span class="cf">for</span> residue <span class="kw">in</span> classA]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>classBmolecules<span class="op">=</span>[getMoleculesFromRcsb(residue) <span class="cf">for</span> residue <span class="kw">in</span> classB]</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>classCmolecules<span class="op">=</span>[getMoleculesFromRcsb(residue) <span class="cf">for</span> residue <span class="kw">in</span> classC]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="class-a-molecules" class="level3">
<h3 class="anchored" data-anchor-id="class-a-molecules">Class A molecules</h3>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(classAmolecules,molsPerRow<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="75">
<p><img src="2022-11-07-binding-site-comparison-benchmark_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="class-b-molecules" class="level3">
<h3 class="anchored" data-anchor-id="class-b-molecules">Class B molecules</h3>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(classBmolecules,molsPerRow<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="76">
<p><img src="2022-11-07-binding-site-comparison-benchmark_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="class-c-molecules" class="level3">
<h3 class="anchored" data-anchor-id="class-c-molecules">Class C molecules</h3>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(classCmolecules,molsPerRow<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">
<p><img src="2022-11-07-binding-site-comparison-benchmark_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>An overall observation is that several molecules in all three classes are rather fragments than actual specific drug-like molecules. This is usually a warning sign on the reliability of the structure &amp; the positioning of the fragment itself. There are several examples underlinging these limitations, but one of the more recent ones <a href="https://www.biorxiv.org/content/10.1101/2022.11.02.514751v1">can be found here</a> - <span class="citation" data-cites="Mehlman2022">Mehlman et al. (<a href="#ref-Mehlman2022" role="doc-biblioref">2022</a>)</span>. The dataset also contains saturated &amp; unsaturated alkyl chains or fatty acids. Obtaining any sort of specificity in purely hydrophobic binding sites is not straightforward to say the least. We find yet again several nucleosides or derivatives. Last, some molecules wouldn’t even pass filters like PAINS or such.</p>
</section>
</section>
</section>
<section id="general-note" class="level1">
<h1>General Note</h1>
<p>While browsing through the litterature and the SI associated to various binding site comparison papers using “benchmark” sets, I found it rather difficult to get a good understanding of what the actual binding site encompassed. So, on top of the composition of the benchmark sets, I think one could do better in litterature on communicating the location of binding sites (i.e.&nbsp;pdb code, chain(s), ligand residue code (and chain), list of residues (and chain)). This would help solving some ambiguities when trying to use such datasets on not so trivial cases, like several conformations of NMR structures, binding sites encompassing other small molecules (are they considered to be part of the binding site or not) like dihydrofolate reductase etc. Working with lists of residues would also help to add protein protein interfaces in the list of examples (I didn’t see ANY example in the benchmark set) and one could even consider having a canonical list of residues per protein among a list of structures.</p>
</section>
<section id="similar-folds-contain-similar-binding-sites" class="level1">
<h1>Similar folds contain similar binding sites</h1>
<p>Another way to assess binding site comparison algorithms is to check whether they are able to find binding sites that are part of different proteins but the same or similar SCOP families. SCOP is a structural classification of proteins by fold.</p>
<p>SCOP is regularly used to assess whether two proteins have overall structural similarities (for instance <a href="https://pubs.acs.org/doi/pdf/10.1021/acs.jcim.9b00554">here</a> <span class="citation" data-cites="Simonovsky2020">Simonovsky and Meyers (<a href="#ref-Simonovsky2020" role="doc-biblioref">2020</a>)</span> and <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-018-2109-2">here</a> <span class="citation" data-cites="Govindaraj2018">Govindaraj and Brylinski (<a href="#ref-Govindaraj2018" role="doc-biblioref">2018</a>)</span> ) but I haven’t seen a paper building an actual consistent benchmark set from SCOP &amp; other information as well (comments are welcome, I guess I have missed something in the existing litterature).</p>
<p>For example, HSP90, DNA topoisomerase II &amp; histidine kinases are all in the same <a href="https://scop.berkeley.edu/sunid=55873&amp;ver=1.73">SCOP family</a> and they all share a common fold on the ATP binding site, even though there are local dissimilarities.</p>
<p><img src="3decision_3dviewer_image.png" title="Example of similarities between HSP90, histidine kinase PrrB &amp; DNA gyrase B" class="img-fluid" alt="Example of similarities between HSP90, histidine kinase PrrB &amp; DNA gyrase B"> <em>Example of a superimposition done with 3decision between three unrelated proteins but similar folds (HSP90 holo structure 4cwr, histidine kinase apo 1ys3 and a DNA gyrase B holo structure 4hz5) - typically difficult to superpose with i.e.&nbsp;PyMOL</em></p>
<p>Here the local similarities are obvious: beta-sheet at the bottom of the ATP binding site with a very well conserved aspartate, three binding site lining helices. However, the actual conformations, breaks &amp; extent of the helices differs a lot between the three structures taken as an example here.</p>
</section>
<section id="perspective" class="level1">
<h1>Perspective</h1>
<p>Summing up I’ll try to work on establishing one or two novel sets along the following principles when trying to find similar binding sites from a large collection of binding sites (like all known or putative binding sites from the RCSB) 1. it should be purely structure based (no ligands / interactions involved &amp; encompass apo structures as well) 2. what is obviously similar should be retrieved first (higher similarities) 3. what is objectively similar (like the example from the SCOP family above) should also be retrieved with lower similarity to the previous 4. a hand picked &amp; human validated set of structural similarities between totally unrelated proteins / structures / binding sites, but might be less similar than the above 5. no explicit definiton of decoys</p>
<section id="what-is-obviously-similar-should-be-retrieved-first" class="level2">
<h2 class="anchored" data-anchor-id="what-is-obviously-similar-should-be-retrieved-first">What is obviously similar should be retrieved first</h2>
<p>When searching large collections of structures having a single or a set of binding sites as query, I’d expect to find the structures of the same protein containing the same binding site with no or few changes (mutations, flexibility) before any other hits (proteins / binding sites), unless these other hits are locally as similar as the query protein structures themselves. This can / should happen for close homologs in common protein families.</p>
</section>
<section id="what-is-objectively-similar" class="level2">
<h2 class="anchored" data-anchor-id="what-is-objectively-similar">What is objectively similar</h2>
<p>That’s a principle that is easy to say, but not as easy to verify &amp; implement. While the previous point was scoped on the same or similar sequence space (protein families, homologs), this one should check known obvious similarities, like same fold &amp; minor mutations / flexibility in the binding site.</p>
</section>
<section id="totally-unrelated-proteins" class="level2">
<h2 class="anchored" data-anchor-id="totally-unrelated-proteins">Totally unrelated proteins</h2>
<p>Tricky, but that’s what a lot of academics seem to focus on.</p>
</section>
<section id="no-explicit-definition-of-decoys" class="level2">
<h2 class="anchored" data-anchor-id="no-explicit-definition-of-decoys">No explicit definition of decoys</h2>
<p>That’s another not so trivial thing, but typically in the prospeccts paper (and others) decoys are usually defined as pairs of binding sites that shouldn’t match. For similar reasons as with decoys in virtual screening experiments, when there is no actual experimental proof that a decoy is a decoy one shouldn’t use it as a decoy. Not to mention biases this introduces intrinsically as well. If no decoys are available, we won’t be able however to compare against ROC curves vs the litterature, if that was to be our aim. Rather than following that path, I’d set up binding site similarity searches against all known &amp; putative pockets and evaluate how much of what I should get out from a similarity search, I actually get out.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Barelier2015" class="csl-entry" role="listitem">
Barelier, Sarah, Teague Sterling, Matthew J. O’Meara, and Brian K. Shoichet. 2015. <span>“The Recognition of Identical Ligands by Unrelated Proteins.”</span> <em><span>ACS</span> Chemical Biology</em> 10 (12): 2772–84. <a href="https://doi.org/10.1021/acschembio.5b00683">https://doi.org/10.1021/acschembio.5b00683</a>.
</div>
<div id="ref-Cerisier2019" class="csl-entry" role="listitem">
Cerisier, Petitjean, Regad, Bayard, Réau, Badel, and Camproux. 2019. <span>“High Impact: The Role of Promiscuous Binding Sites in Polypharmacology.”</span> <em>Molecules</em> 24 (14): 2529. <a href="https://doi.org/10.3390/molecules24142529">https://doi.org/10.3390/molecules24142529</a>.
</div>
<div id="ref-Ehrt2018" class="csl-entry" role="listitem">
Ehrt, Christiane, Tobias Brinkjost, and Oliver Koch. 2018. <span>“A Benchmark Driven Guide to Binding Site Comparison: An Exhaustive Evaluation Using Tailor-Made Data Sets (<span>ProSPECCTs</span>).”</span> Edited by Bjoern Peters. <em><span>PLOS</span> Computational Biology</em> 14 (11): e1006483. <a href="https://doi.org/10.1371/journal.pcbi.1006483">https://doi.org/10.1371/journal.pcbi.1006483</a>.
</div>
<div id="ref-Gold2006" class="csl-entry" role="listitem">
Gold, Nicola D., and Richard M. Jackson. 2006. <span>“Fold Independent Structural Comparisons of Protein<span></span>ligand Binding Sites for Exploring Functional Relationships.”</span> <em>Journal of Molecular Biology</em> 355 (5): 1112–24. <a href="https://doi.org/10.1016/j.jmb.2005.11.044">https://doi.org/10.1016/j.jmb.2005.11.044</a>.
</div>
<div id="ref-Govindaraj2018" class="csl-entry" role="listitem">
Govindaraj, Rajiv Gandhi, and Michal Brylinski. 2018. <span>“Comparative Assessment of Strategies to Identify Similar Ligand-Binding Pockets in Proteins.”</span> <em><span>BMC</span> Bioinformatics</em> 19 (1). <a href="https://doi.org/10.1186/s12859-018-2109-2">https://doi.org/10.1186/s12859-018-2109-2</a>.
</div>
<div id="ref-Kahraman2009" class="csl-entry" role="listitem">
Kahraman, Abdullah, Richard J. Morris, Roman A. Laskowski, Angelo D. Favia, and Janet M. Thornton. 2009. <span>“On the Diversity of Physicochemical Environments Experienced by Identical Ligands in Binding Pockets of Unrelated Proteins.”</span> <em>Proteins: Structure, Function, and Bioinformatics</em> 78 (5): 1120–36. <a href="https://doi.org/10.1002/prot.22633">https://doi.org/10.1002/prot.22633</a>.
</div>
<div id="ref-Mehlman2022" class="csl-entry" role="listitem">
Mehlman, Tamar (Skaist), Justin T. Biel, Syeda Maryam Azeem, Elliot R. Nelson, Sakib Hossain, Louise E. Dunnett, Neil G. Paterson, et al. 2022. <span>“Room-Temperature Crystallography Reveals Altered Binding of Small-Molecule Fragments to <span>PTP</span>1B,”</span> November. <a href="https://doi.org/10.1101/2022.11.02.514751">https://doi.org/10.1101/2022.11.02.514751</a>.
</div>
<div id="ref-Morris2005" class="csl-entry" role="listitem">
Morris, R. J., R. J. Najmanovich, A. Kahraman, and J. M. Thornton. 2005. <span>“Real Spherical Harmonic Expansion Coefficients as 3D Shape Descriptors for Protein Binding Pocket and Ligand Comparisons.”</span> <em>Bioinformatics</em> 21 (10): 2347–55. <a href="https://doi.org/10.1093/bioinformatics/bti337">https://doi.org/10.1093/bioinformatics/bti337</a>.
</div>
<div id="ref-Simonovsky2020" class="csl-entry" role="listitem">
Simonovsky, Martin, and Joshua Meyers. 2020. <span>“<span>DeeplyTough</span>: Learning Structural Comparison of Protein Binding Sites.”</span> <em>Journal of Chemical Information and Modeling</em> 60 (4): 2356–66. <a href="https://doi.org/10.1021/acs.jcim.9b00554">https://doi.org/10.1021/acs.jcim.9b00554</a>.
</div>
<div id="ref-Weill2010" class="csl-entry" role="listitem">
Weill, Nathanaël, and Didier Rognan. 2010. <span>“Alignment-Free Ultra-High-Throughput Comparison of Druggable Protein-Ligand Binding Sites.”</span> <em>Journal of Chemical Information and Modeling</em> 50 (1): 123–35. <a href="https://doi.org/10.1021/ci900349y">https://doi.org/10.1021/ci900349y</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>